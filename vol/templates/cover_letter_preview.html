{% extends "base.html" %}

{% block title %}Preview Cover Letter - ResumeBuilder{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0">Preview Cover Letter</h1>
                <div>
                    <a href="/create-cover-letter" class="btn btn-outline-secondary me-2">
                        <i class="fas fa-arrow-left"></i> Back to Form
                    </a>
                    <button onclick="window.print()" class="btn btn-primary me-2">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button onclick="downloadPDF()" class="btn btn-success">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-body p-0">
                            <div class="cover-letter-preview template-{{ template }}">
                                <div class="header p-4">
                                    <div class="name">{{ current_user.username }}</div>
                                    <div class="contact-info">
                                        {% if current_user.email %}{{ current_user.email }}<br>{% endif %}
                                        {% if current_user.phone %}{{ current_user.phone }}<br>{% endif %}
                                        {% if current_user.address %}{{ current_user.address }}{% endif %}
                                    </div>
                                </div>
                                
                                <div class="date px-4">
                                    {{ now.strftime('%B %d, %Y') }}
                                </div>
                                
                                <div class="recipient px-4">
                                    {% if company %}
                                    <strong>{{ company }}</strong><br>
                                    {% endif %}
                                    {% if job_title %}
                                    Re: {{ job_title }} Position
                                    {% endif %}
                                </div>
                                
                                <div class="content px-4">
                                    {{ content|safe|replace('\n', '<br>') }}
                                </div>
                                
                                <div class="signature px-4">
                                    Sincerely,<br><br>
                                    {{ current_user.username }}
                                </div>
                                
                                {% if not session.get('is_premium') %}
                                <div class="watermark">
                                    Generated by ResumeBuilder<br>
                                    Upgrade to remove watermark
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-info-circle"></i> Cover Letter Details</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <strong>Title:</strong><br>
                                {{ title or 'Untitled Cover Letter' }}
                            </div>
                            {% if job_title %}
                            <div class="mb-3">
                                <strong>Job Title:</strong><br>
                                {{ job_title }}
                            </div>
                            {% endif %}
                            {% if company %}
                            <div class="mb-3">
                                <strong>Company:</strong><br>
                                {{ company }}
                            </div>
                            {% endif %}
                            <div class="mb-3">
                                <strong>Template:</strong><br>
                                <span class="badge bg-{{ 'success' if template == 'standard' else 'warning' if template == 'creative' else 'info' }}">
                                    {{ template.title() }}
                                </span>
                                {% if template in ['creative', 'executive'] and not session.get('is_premium') %}
                                <span class="badge bg-warning text-dark">
                                    <i class="fas fa-crown"></i> Premium
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-lightbulb"></i> Tips</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled mb-0">
                                <li class="mb-2">
                                    <i class="fas fa-check text-success"></i> Review for typos and grammar
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success"></i> Ensure it's tailored to the job
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success"></i> Keep it under one page
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success"></i> Use specific examples
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.cover-letter-preview {
    font-family: 'Times New Roman', serif;
    line-height: 1.6;
    color: #333;
    min-height: 800px;
    position: relative;
}

.cover-letter-preview .name {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 5px;
}

.cover-letter-preview .contact-info {
    font-size: 12px;
    color: #666;
    margin-bottom: 20px;
}

.cover-letter-preview .date {
    margin-bottom: 30px;
}

.cover-letter-preview .recipient {
    margin-bottom: 30px;
}

.cover-letter-preview .content {
    text-align: justify;
    margin-bottom: 30px;
}

.cover-letter-preview .signature {
    margin-top: 40px;
}

.cover-letter-preview .watermark {
    position: absolute;
    bottom: 20px;
    right: 20px;
    font-size: 10px;
    color: #ffa500;
    font-weight: bold;
}

/* Template-specific styles */
.template-standard {
    font-family: 'Times New Roman', serif;
}

.template-creative {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 20px;
    border-radius: 10px;
}

.template-executive {
    font-family: 'Georgia', serif;
    border-left: 4px solid #2c3e50;
    padding-left: 20px;
}

.template-creative .name {
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 10px;
}

.template-executive .name {
    color: #2c3e50;
    font-size: 28px;
}

@media print {
    .btn, .card-header, .col-lg-4 {
        display: none !important;
    }
    .cover-letter-preview {
        min-height: auto;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
function downloadPDF() {
    // Create a form to submit the cover letter data for PDF generation
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/preview-cover-letter-pdf';
    
    const data = {
        title: '{{ title }}',
        job_title: '{{ job_title }}',
        company: '{{ company }}',
        content: '{{ content|replace("\n", "\\n")|replace("\'", "\\\'") }}',
        template: '{{ template }}'
    };
    
    for (const [key, value] of Object.entries(data)) {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = key;
        input.value = value;
        form.appendChild(input);
    }
    
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
}
</script>
{% endblock %} 