{% extends "base.html" %}

{% block title %}Dashboard - ResumeBuilder Pro{% endblock %}

{% block content %}
<style>
.dash-bg {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    padding-top: 20px;
}
.card, .card.shadow-sm {
    border-radius: 16px !important;
    box-shadow: 0 4px 24px rgba(0,0,0,0.07) !important;
    border: none !important;
}
.stat-card {
    transition: transform 0.2s ease-in-out;
}
.stat-card:hover {
    transform: translateY(-5px);
}
.progress-ring {
    width: 80px;
    height: 80px;
}
.progress-ring circle {
    fill: none;
    stroke-width: 4;
    stroke-linecap: round;
}
.progress-ring .bg {
    stroke: #e9ecef;
}
.progress-ring .progress {
    stroke: #2563eb;
    stroke-dasharray: 251.2;
    stroke-dashoffset: calc(251.2 - (251.2 * var(--progress)) / 100);
    transition: stroke-dashoffset 0.5s ease;
}
</style>

<div class="dash-bg">
    <div class="container-fluid">
        <!-- Welcome Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h2 mb-1">Welcome back, {{ current_user.username }}! ðŸ‘‹</h1>
                        <p class="text-muted mb-0">
                            <i class="bi bi-calendar3 me-1"></i>
                            {{ now.strftime('%A, %B %d, %Y') }}
                        </p>
                    </div>
                    <div class="d-flex align-items-center gap-3">
                        {% if is_premium %}
                        <span class="badge bg-warning text-dark px-3 py-2">
                            <i class="bi bi-star-fill me-1"></i>Premium Member
                        </span>
                        {% else %}
                        <a href="{{ url_for('upgrade') }}" class="btn btn-warning btn-sm">
                            <i class="bi bi-star me-1"></i>Upgrade to Premium
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Reminders -->
        {% if reminders %}
        <div class="row mb-4">
            <div class="col-12">
                {% for r in reminders %}
                <div class="alert alert-info d-flex align-items-center border-0 shadow-sm" role="alert">
                    <i class="bi bi-bell-fill me-3 text-primary"></i>
                    <div class="flex-grow-1">
                        <strong>Reminder:</strong> {{ r.message }}
                        <span class="text-muted ms-2">(Due: {{ r.due_date.strftime('%b %d, %Y') }})</span>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Ad-Free Notice -->
        {{ ad_free_notice() }}

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="card stat-card bg-gradient-primary text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="mb-1 fw-bold">{{ dashboard.resumes_created }}</h3>
                                <p class="mb-0 opacity-75">Resumes Created</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-circle p-3">
                                <i class="bi bi-file-earmark-text text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="card stat-card bg-gradient-success text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="mb-1 fw-bold">{{ dashboard.applications_submitted }}</h3>
                                <p class="mb-0 opacity-75">Applications</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-circle p-3">
                                <i class="bi bi-send text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="card stat-card bg-gradient-info text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="mb-1 fw-bold">{{ dashboard.interviews_attended }}</h3>
                                <p class="mb-0 opacity-75">Interviews</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-circle p-3">
                                <i class="bi bi-camera-video text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="card stat-card bg-gradient-warning text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="mb-1 fw-bold">{{ dashboard.offers_received }}</h3>
                                <p class="mb-0 opacity-75">Offers</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-circle p-3">
                                <i class="bi bi-trophy text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Overview -->
        <div class="row mb-4">
            <div class="col-lg-8">
                <div class="card h-100">
                    <div class="card-header bg-transparent border-0">
                        <h5 class="mb-0 fw-bold">
                            <i class="bi bi-graph-up me-2 text-primary"></i>Job Search Progress
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center p-3 bg-light rounded">
                                    <div class="progress-ring me-3" style="--progress: {{ (dashboard.applications_submitted / 10) * 100 if dashboard.applications_submitted > 0 else 0 }}">
                                        <svg viewBox="0 0 100 100">
                                            <circle class="bg" cx="50" cy="50" r="40"></circle>
                                            <circle class="progress" cx="50" cy="50" r="40"></circle>
                                        </svg>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">Applications</h6>
                                        <p class="mb-0 text-muted">{{ dashboard.applications_submitted }}/10 target</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center p-3 bg-light rounded">
                                    <div class="progress-ring me-3" style="--progress: {{ (dashboard.interviews_attended / 5) * 100 if dashboard.interviews_attended > 0 else 0 }}">
                                        <svg viewBox="0 0 100 100">
                                            <circle class="bg" cx="50" cy="50" r="40"></circle>
                                            <circle class="progress" cx="50" cy="50" r="40"></circle>
                                        </svg>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">Interviews</h6>
                                        <p class="mb-0 text-muted">{{ dashboard.interviews_attended }}/5 target</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-header bg-transparent border-0">
                        <h5 class="mb-0 fw-bold">
                            <i class="bi bi-lightning me-2 text-warning"></i>Quick Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('create_resume') }}" class="btn btn-primary">
                                <i class="bi bi-plus-circle me-2"></i>Create New Resume
                            </a>
                            <a href="{{ url_for('my_cover_letters') }}" class="btn btn-outline-primary">
                                <i class="bi bi-envelope me-2"></i>Write Cover Letter
                            </a>
                            <a href="{{ url_for('job_application_tracker') }}" class="btn btn-outline-success">
                                <i class="bi bi-graph-up me-2"></i>Track Applications
                            </a>
                            <a href="{{ url_for('interview_prep_advanced') }}" class="btn btn-outline-warning">
                                <i class="bi bi-camera-video me-2"></i>Practice Interview
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold">
                            <i class="bi bi-file-earmark-text me-2 text-primary"></i>Recent Resumes
                        </h5>
                        <a href="{{ url_for('my_resumes') }}" class="btn btn-sm btn-outline-primary">View All</a>
                    </div>
                    <div class="card-body">
                        {% if recent_resumes %}
                        <div class="list-group list-group-flush">
                            {% for resume in recent_resumes %}
                            <div class="list-group-item border-0 px-0">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">{{ resume.name or 'Untitled Resume' }}</h6>
                                        <small class="text-muted">
                                            <i class="bi bi-calendar me-1"></i>
                                            {{ resume.updated_at.strftime('%b %d, %Y') }}
                                        </small>
                                    </div>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{{ url_for('edit_resume', resume_id=resume.id) }}" class="btn btn-outline-primary btn-sm">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <a href="{{ url_for('preview_resume', resume_id=resume.id) }}" class="btn btn-outline-success btn-sm">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <i class="bi bi-file-earmark-text text-muted" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-2">No resumes yet. Create your first one!</p>
                            <a href="{{ url_for('create_resume') }}" class="btn btn-primary">Create Resume</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold">
                            <i class="bi bi-briefcase me-2 text-success"></i>Recent Applications
                        </h5>
                        <a href="{{ url_for('job_application_tracker') }}" class="btn btn-sm btn-outline-success">View All</a>
                    </div>
                    <div class="card-body">
                        {% if recent_jobs %}
                        <div class="list-group list-group-flush">
                            {% for job in recent_jobs %}
                            <div class="list-group-item border-0 px-0">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">{{ job.job_title }}</h6>
                                        <small class="text-muted">{{ job.company }}</small>
                                        <br>
                                        <span class="badge bg-{{ 'success' if job.status == 'offer' else 'warning' if job.status == 'interview' else 'info' if job.status == 'applied' else 'secondary' }}">
                                            {{ job.status.title() }}
                                        </span>
                                    </div>
                                    <small class="text-muted">
                                        {{ job.applied_date.strftime('%b %d') }}
                                    </small>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <i class="bi bi-briefcase text-muted" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-2">No applications yet. Start tracking your job search!</p>
                            <a href="{{ url_for('job_application_tracker') }}" class="btn btn-success">Track Applications</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CSS for gradient backgrounds -->
<style>
.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
.bg-gradient-success {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}
.bg-gradient-info {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
.bg-gradient-warning {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}
</style>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('dashboardChart').getContext('2d');
const dashboardChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Resumes', 'Cover Letters', 'Applications', 'Practice Sessions'],
        datasets: [{
            label: 'Count',
            data: [
                {{ dashboard.resumes_created|default(0) }},
                {{ dashboard.cover_letters_created|default(0) }},
                {{ dashboard.applications_submitted|default(0) }},
                {{ dashboard.practice_sessions_completed|default(0) }}
            ],
            backgroundColor: [
                'rgba(13,110,253,0.7)',
                'rgba(25,135,84,0.7)',
                'rgba(13,202,240,0.7)',
                'rgba(255,193,7,0.7)'
            ],
            borderColor: [
                'rgba(13,110,253,1)',
                'rgba(25,135,84,1)',
                'rgba(13,202,240,1)',
                'rgba(255,193,7,1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false },
            title: { display: false }
        },
        scales: {
            y: { beginAtZero: true, ticks: { stepSize: 1 } }
        }
    }
});
</script>
{% endblock %} 