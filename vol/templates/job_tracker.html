{% extends 'base.html' %}
{% block title %}Job Tracker | Resume Builder{% endblock %}
{% block content %}
<h2 class="mb-4">Job Tracker</h2>
<div class="mb-3 d-flex justify-content-between align-items-center">
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addJobModal"><i class="bi bi-plus-lg me-1"></i>Add Job Application</button>
  <button class="btn btn-outline-secondary" disabled>Analytics <i class='bi bi-lock-fill text-warning'></i> (Premium)</button>
</div>
<div class="alert alert-info text-center mb-4">
  <i class="bi bi-lock-fill text-warning"></i> <strong>Upgrade to Premium</strong> to unlock analytics and advanced job tracking features!
</div>
<div id="jobApps" class="row g-4">
  <!-- Job applications will be rendered here -->
</div>
<!-- Add Job Modal -->
<div class="modal fade" id="addJobModal" tabindex="-1" aria-labelledby="addJobModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addJobModalLabel">Add Job Application</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="jobForm">
          <div class="mb-3">
            <label class="form-label">Company</label>
            <input type="text" class="form-control" id="jobCompany" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Position</label>
            <input type="text" class="form-control" id="jobPosition" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select class="form-select" id="jobStatus">
              <option value="Applied">Applied</option>
              <option value="Interview">Interview</option>
              <option value="Offer">Offer</option>
              <option value="Rejected">Rejected</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Notes</label>
            <textarea class="form-control" id="jobNotes" rows="2"></textarea>
          </div>
          <button type="submit" class="btn btn-success w-100">Save Application</button>
        </form>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Job applications in localStorage for demo (replace with DB in production)
const key = 'jobApps';
function getJobs() {
  try {
    return JSON.parse(localStorage.getItem(key) || '[]');
  } catch (e) {
    console.log('Error loading jobs, using empty array');
    return [];
  }
}
function saveJobs(jobs) {
  try {
    localStorage.setItem(key, JSON.stringify(jobs));
  } catch (e) {
    console.error('Error saving jobs:', e);
  }
}
function renderJobs() {
  try {
    const jobs = getJobs();
    const container = document.getElementById('jobApps');
    container.innerHTML = '';
    if (jobs.length === 0) {
      container.innerHTML = '<div class="col-12"><div class="alert alert-info">No job applications yet. Click "Add Job Application" to get started!</div></div>';
      return;
    }
    jobs.forEach((j, i) => {
      const card = document.createElement('div');
      card.className = 'col-md-6 col-lg-4';
      let badge = 'secondary';
      if (j.status === 'Applied') badge = 'primary';
      if (j.status === 'Interview') badge = 'info';
      if (j.status === 'Offer') badge = 'success';
      if (j.status === 'Rejected') badge = 'danger';
      card.innerHTML = `
        <div class="card shadow-sm transition h-100">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title mb-2"><i class="bi bi-building me-2 text-primary"></i>${j.company}</h5>
            <p class="mb-2"><strong>Position:</strong> ${j.position}</p>
            <span class="badge bg-${badge} mb-2">${j.status}</span>
            <p class="mb-2 text-muted">${j.notes || ''}</p>
            <button class="btn btn-outline-danger btn-sm mt-auto" onclick="deleteJob(${i})"><i class="bi bi-trash"></i> Delete</button>
          </div>
        </div>
      `;
      container.appendChild(card);
    });
  } catch (e) {
    console.error('Error rendering jobs:', e);
  }
}
function deleteJob(idx) {
  try {
    const jobs = getJobs();
    jobs.splice(idx, 1);
    saveJobs(jobs);
    renderJobs();
  } catch (e) {
    console.error('Error deleting job:', e);
  }
}
document.getElementById('jobForm').onsubmit = function(e) {
  e.preventDefault();
  try {
    const company = document.getElementById('jobCompany').value.trim();
    const position = document.getElementById('jobPosition').value.trim();
    const status = document.getElementById('jobStatus').value;
    const notes = document.getElementById('jobNotes').value.trim();
    if (!company || !position) return;
    const jobs = getJobs();
    jobs.push({company, position, status, notes});
    saveJobs(jobs);
    renderJobs();
    document.getElementById('jobForm').reset();
    bootstrap.Modal.getInstance(document.getElementById('addJobModal')).hide();
  } catch (e) {
    console.error('Error adding job:', e);
    alert('Error adding job application. Please try again.');
  }
};
renderJobs();
</script>
{% endblock %} 